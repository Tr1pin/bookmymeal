<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Producto</title>
</head>
<body>
  <h1>Crear Producto</h1>
  <form id="productoForm" method="post" enctype="multipart/form-data">
    <label for="nombre">Nombre:</label>
    <input type="text" name="nombre" id="nombre" required><br><br>

    <label for="descripcion">Descripción:</label>
    <textarea name="descripcion" id="descripcion" required></textarea><br><br>

    <label for="precio">Precio:</label>
    <input type="number" name="precio" id="precio" step="0.01" required><br><br>

    <label for="disponible">Disponible:</label>
    <input type="checkbox" name="disponible" id="disponible"><br><br>

    <label for="imagen">Imágenes (Selecciona múltiples):</label>
    <input type="file" name="imagen" id="imagen" multiple accept="image/*" required><br>
    <div id="imagePreview" class="preview-container"></div>
    <br>

    <button type="submit">Enviar</button>
  </form>

  <script>
    // Mostrar vista previa de imágenes
    document.getElementById('imagen').addEventListener('change', function(e) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = ''; // Limpiar previsualizaciones anteriores
      
      for (const file of this.files) {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.classList.add('image-preview');
            preview.appendChild(img);
          }
          reader.readAsDataURL(file);
        }
      }
    });

    document.getElementById('productoForm').addEventListener('submit', formulario);

    async function formulario(e) {
      e.preventDefault();
      console.log("En la función");

      const form = e.target;
      const formData = new FormData();

      // Agregar campos de texto
      formData.append("nombre", form.elements['nombre'].value);
      formData.append("descripcion", form.elements['descripcion'].value);
      formData.append("precio", form.elements['precio'].value);
      formData.append("disponible", form.elements['disponible'].checked ? 'true' : 'false');

      // Agregar múltiples archivos
      const archivos = form.elements['imagen'].files;
      for (let i = 0; i < archivos.length; i++) {
        formData.append("imagen", archivos[i]);
      }

      try {
        const response = await fetch('http://localhost:3001/productos/', {
          method: 'POST',
          body: formData,
        });

        const data = await response.json();
        console.log('Respuesta del servidor:', data);
        
        if (response.ok) {
          alert('Producto creado correctamente');
          form.reset();
          document.getElementById('imagePreview').innerHTML = '';
        } else {
          alert('Error al crear el producto: ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al enviar el producto');
      }
    }
  </script>
</body>
</html>
